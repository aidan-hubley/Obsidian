#DatabseSecurity
# Exploitation
- Using Vulnerabilities to gain Access/Control

## Locate and Gather
- Locate weakness and gain access to databases
- Begin constructing theoretical picture of structure
	- Database scheme - the logical structure of the database
	- Stored procedures, tables, views, users, etc.
	- Database Vendor (MySQL, Microsoft, Oracle) and Version
		- SQL syntax
		- Defaults (procedures, logins, roles, etc)
		- Query processing methods
		- Storage mechanisms

## Clues to Vendor Identity
- Vendors lean towards 1-2 Scripting Language
	- PHP = MySQL
	- .NET = Microsoft SQL Server
	- JavaScript = Oracle
- Platform
	- SQL Server = Microsoft Windows Server
	- Open Source = MySQL / Oracle
- Database Response
	- Syntax / Error formats provide distinct clues
	- Error Codes found on Vendor websites

## Identify Vendor Version
- Provides system capabilities
- Search for known vulnerabilities
- If Vendor is known, version is easy with standard queries
	- MS SQL Server: SELECT @@VERSION
		- Version, Processor, OS, Service Pack and Build
	- MySQL: SHOW VARIABLES LIKE "%version%"
		- Version, OS, Patch Version, etc.
	- Oracle: SELECT * FROM V$INSTANCE

## Database Specific Statements
- Determine Database Name, Location, Language

## Extract Real Data
- After gathering information ABOUT
- Now Construct Queries to gather Data
- Access restricted by current user

## Using Union
- Add chosen queries ONTO existing statements
- Union combines SQL Statements
- Example:
	- Take current GET
	- UNION SELECT Table_Name FROM Information_Schema.Table-
- Both results returned

## Finish with Union
- ...

## Using Conditions
- True -> Return a Value
- False -> Return an error
- Used when UNION not allowed
- Example: Am I the Administrator?

## Include Delays

# Database Names -> Table Names


# Advanced Techniques
## Filter Bypass Techniques
- Encoding 
	- Example: Instead of using ,' use %27
- Change Case of Keywords
	- uNION
- Concatenate
	- "U" + "NIO" + "N"
- Alternative Statements
	- Case instead of IF

# Privilege Escalation
- Passwords Hashed = Problem
- Backdoor strategies - vendor/version specific

## Brute Force
- Trial and Error with Every combination
- More background info = more access

## Automated Tools
- Havji
- BBQSQL
- Laviathan
- WhiteWidow
- ...

## OPENROWSET
- Microsoft SQL Server
- Remotely connect to a different database and connect as another user

<hr>

# Defense
## The Basics
- Discern Infrastructure Weaknesses
- System Monitoring
- Use Multiple Strategies

## Bond Parameters
- "Placeholders
- Malformed User Inputs does not affect SQL Statement"

# Sanitize Data
- Block Key Words
- Filter Key Words
	- Block Known Keywords
	- Allow others
	- Filter based on expected input words

## Restrict/Segregate Databases
- Assign privileges with greatest granularity available
- Injections processed using Web applications...

## Design with Security
- Where are things stored and how viewed by outsiders
- Naming - what information is given away
- Change default names
- Do not use object views for critical database objects
- Create a honeypot environment

## Diligent Monitoring
- Errors show real-time attacks
- Resource usage uncovers automated attacks
	- Database queries per minute
	- Database requests per minute
- Baselines provide thresholds for alerts